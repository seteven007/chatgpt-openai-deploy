
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>AIå›¾åƒå·¥ä½œå®¤ - é£æ ¼å›¾ + AIæ¢è„¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial; background: #121212; color: white; text-align: center; padding: 30px; }
    section { background: #1e1e2f; border-radius: 10px; padding: 20px; max-width: 600px; margin: 30px auto; }
    input, button { margin-top: 10px; }
    img { margin-top: 15px; max-width: 100%; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>ğŸ¨ AIå›¾åƒå·¥ä½œå®¤</h1>
  <p>åŒ…å«ï¼šé£æ ¼å›¾ç”Ÿæˆ + AIæ¢è„¸</p>

  <section>
    <h2>ğŸŒˆ é£æ ¼å›¾ç”Ÿæˆ</h2>
    <input type="file" id="fileInput" accept="image/*" />
    <button onclick="uploadAndGenerate()">ä¸Šä¼ å¹¶ç”Ÿæˆ</button>
    <p id="status">ç­‰å¾…ä¸Šä¼ ...</p>
    <img id="outputImage" src="" style="display:none;" />
  </section>

  <section>
    <h2>ğŸ­ AIæ¢è„¸</h2>
    <input type="file" id="faceA" accept="image/*" />
    <input type="file" id="faceB" accept="image/*" />
    <button onclick="uploadAndSwap()">ä¸Šä¼ å¹¶æ¢è„¸</button>
    <p id="swapStatus">ç­‰å¾…ä¸Šä¼ ...</p>
    <img id="faceResult" src="" style="display:none;" />
  </section>

  <script>
    const uploadApi = "https://api.upload.io/v2/accounts/uploadio/uploads/binary";
    const uploadKey = "public_W23MTD3bzUbxT6pP6Z6eVZzharqQ";
    const replicateKey = "r8_RbeImSevv5mxwF6pNxETVBo6ROms3ra3erJRz";

    async function uploadAndGenerate() {
      const file = document.getElementById('fileInput').files[0];
      const status = document.getElementById('status');
      const output = document.getElementById('outputImage');
      if (!file) return alert("è¯·ä¸Šä¼ å›¾ç‰‡");

      status.textContent = "ğŸš€ æ­£åœ¨ä¸Šä¼ ...";
      const res = await fetch(uploadApi, {
        method: "POST",
        headers: { "Authorization": uploadKey },
        body: file
      });
      const data = await res.json();
      if (!data?.fileUrl) return status.textContent = "âŒ ä¸Šä¼ å¤±è´¥";

      const imgUrl = data.fileUrl;
      status.textContent = "ğŸ¨ æ­£åœ¨ç”Ÿæˆé£æ ¼å›¾...";

      const predict = await fetch("https://api.replicate.com/v1/predictions", {
        method: "POST",
        headers: {
          "Authorization": "Token " + replicateKey,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          version: "db21e45b37db63992d4c99f6cbefccafe1c0fdfda12e1c04f835c2a3a0c37317",
          input: {
            image: imgUrl,
            prompt: "cyberpunk portrait, trending on artstation, cinematic lighting",
            num_outputs: 1
          }
        })
      });

      const prediction = await predict.json();
      const pollUrl = prediction?.urls?.get;
      if (!pollUrl) return status.textContent = "âŒ æ¨¡å‹è°ƒç”¨å¤±è´¥";

      let result = "";
      while (!result) {
        const poll = await fetch(pollUrl, {
          headers: { "Authorization": "Token " + replicateKey }
        });
        const pollData = await poll.json();
        if (pollData?.status === "succeeded") {
          result = pollData.output?.[0];
          break;
        }
        await new Promise(r => setTimeout(r, 2000));
      }

      output.src = result;
      output.style.display = "block";
      status.textContent = "âœ… é£æ ¼å›¾å·²ç”Ÿæˆ";
    }

    async function uploadAndSwap() {
      const a = document.getElementById('faceA').files[0];
      const b = document.getElementById('faceB').files[0];
      const status = document.getElementById('swapStatus');
      const resultImg = document.getElementById('faceResult');
      if (!a || !b) return alert("è¯·ä¸Šä¼ ä¸¤å¼ äººè„¸");

      status.textContent = "â¬†ï¸ ä¸Šä¼ äººè„¸å›¾åƒä¸­...";

      const upload = async file => {
        const res = await fetch(uploadApi, {
          method: "POST",
          headers: { "Authorization": uploadKey },
          body: file
        });
        return (await res.json()).fileUrl;
      };

      const urlA = await upload(a);
      const urlB = await upload(b);

      status.textContent = "ğŸ¤– æ­£åœ¨è°ƒç”¨æ¢è„¸æ¨¡å‹...";

      const predict = await fetch("https://api.replicate.com/v1/predictions", {
        method: "POST",
        headers: {
          "Authorization": "Token " + replicateKey,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          version: "c43f6f013d7c4c13927a6212f96e4cf3d101f30be6509ff29468fddcbf7c8ef7",
          input: {
            target_image: urlA,
            source_image: urlB,
            mode: "face"
          }
        })
      });

      const prediction = await predict.json();
      const pollUrl = prediction?.urls?.get;
      if (!pollUrl) return status.textContent = "âŒ æ¨¡å‹è°ƒç”¨å¤±è´¥";

      let result = "";
      while (!result) {
        const poll = await fetch(pollUrl, {
          headers: { "Authorization": "Token " + replicateKey }
        });
        const pollData = await poll.json();
        if (pollData?.status === "succeeded") {
          result = pollData.output;
          break;
        }
        await new Promise(r => setTimeout(r, 2000));
      }

      resultImg.src = result;
      resultImg.style.display = "block";
      status.textContent = "âœ… æ¢è„¸æˆåŠŸ";
    }
  </script>
</body>
</html>
